<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>今天的心情？｜選擇聊天夥伴</title>
  <style>
    :root { --bg:#f7f7f8; --card:#fff; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --primary:#16a34a; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC"; background:var(--bg); color:var(--text); }
    .wrap { max-width: 720px; margin:0 auto; padding:20px; }
    h1 { font-size:22px; margin:8px 0 16px; }
    h2 { font-size:16px; margin:16px 0 8px; color:#111827; }
    p.helper { color:var(--muted); margin:0 0 12px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; }
    .btn { appearance:none; border:1px solid var(--border); background:#fff; padding:10px 12px; border-radius:12px; font-size:18px; cursor:pointer; transition:transform .02s; }
    .btn:active { transform: scale(0.98); }
    .btn.sel { outline:2px solid var(--primary); border-color: #86efac; background:#ecfdf5; }
    .row { display:flex; gap:10px; }
    .bot { flex:1; display:flex; align-items:center; justify-content:center; padding:12px; font-weight:600; }
    .bot .sub { font-size:12px; color:var(--muted); font-weight:500; }
    .footer { position:sticky; bottom:0; background:linear-gradient(180deg, transparent 0, #fff 20px); padding:16px 0 8px; }
    .primary { width:100%; background:var(--primary); border:none; color:#fff; font-weight:700; height:48px; border-radius:12px; font-size:16px; opacity:.9; }
    .primary:disabled { opacity:.4; }
    header { padding:16px 0 8px; }
    .title { font-size:14px; color:var(--muted); }
    #log { font-size:12px; color:#6b7280; margin-top:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Step 1/1</div>
      <h1>今天的心情如何？然後想和誰聊聊</h1>
    </header>

    <section class="card" aria-labelledby="mood-title">
      <h2 id="mood-title">選擇今天的心情（單選）</h2>
      <p class="helper">點一下選擇一個最接近你現在的心情。</p>
      <div class="grid" id="mood-grid">
        <!-- 10 emojis -->
        <button class="btn" data-value="😀" aria-pressed="false">😀</button>
        <button class="btn" data-value="😊" aria-pressed="false">😊</button>
        <button class="btn" data-value="😌" aria-pressed="false">😌</button>
        <button class="btn" data-value="🙂" aria-pressed="false">🙂</button>
        <button class="btn" data-value="😐" aria-pressed="false">😐</button>
        <button class="btn" data-value="😕" aria-pressed="false">😕</button>
        <button class="btn" data-value="😞" aria-pressed="false">😞</button>
        <button class="btn" data-value="😢" aria-pressed="false">😢</button>
        <button class="btn" data-value="😠" aria-pressed="false">😠</button>
        <button class="btn" data-value="🤯" aria-pressed="false">🤯</button>
      </div>
    </section>

    <section class="card" style="margin-top:16px" aria-labelledby="bot-title">
      <h2 id="bot-title">選擇聊天夥伴（單選）</h2>
      <div class="row">
        <button class="btn bot" id="bot-baobao" data-value="baobao" aria-pressed="false">
          <div>
            <div>寶包</div>
            <div class="sub">溫暖陪伴</div>
          </div>
        </button>
        <button class="btn bot" id="bot-penny" data-value="penny" aria-pressed="false">
          <div>
            <div>裴妮</div>
            <div class="sub">理性分析</div>
          </div>
        </button>
      </div>
    </section>

    <div class="footer">
      <button class="primary" id="go" disabled>開始聊天</button>
      <div id="log"></div>
    </div>
  </div>

  <script>
    const CHAT_PAGE = "liff-chat.html"; // 第二頁（同資料夾）
    const moodGrid = document.getElementById("mood-grid");
    const botButtons = [document.getElementById("bot-baobao"), document.getElementById("bot-penny")];
    const goBtn = document.getElementById("go");
    const $log = document.getElementById("log");

    let mood = null;
    let bot = null;

    function log(t){ $log.textContent = t; }
    function selectSingleInGrid(grid, value){
      [...grid.querySelectorAll(".btn")].forEach(b => {
        const sel = b.dataset.value === value;
        b.classList.toggle("sel", sel);
        b.setAttribute("aria-pressed", sel ? "true" : "false");
      });
    }
    function selectSingleInRow(buttons, value){
      buttons.forEach(b => {
        const sel = b.dataset.value === value;
        b.classList.toggle("sel", sel);
        b.setAttribute("aria-pressed", sel ? "true" : "false");
      });
    }
    function updateGo(){
      goBtn.disabled = !(mood && bot);
    }

    moodGrid.addEventListener("click", (e) => {
      const t = e.target.closest("button.btn");
      if (!t) return;
      mood = t.dataset.value;
      selectSingleInGrid(moodGrid, mood);
      updateGo();
    });
    botButtons.forEach(b => b.addEventListener("click", () => {
      bot = b.dataset.value;
      selectSingleInRow(botButtons, bot);
      updateGo();
    }));

    goBtn.addEventListener("click", () => {
      // 存到 storage（第二頁可讀）
      try {
        sessionStorage.setItem("mood", mood);
        sessionStorage.setItem("bot", bot);
        localStorage.setItem("mood", mood);
        localStorage.setItem("bot", bot);
      } catch (e) {}

      // 不帶任何參數（避免某些 WebView 對 emoji/query 的處理問題），直接進聊天頁
      const to = `${CHAT_PAGE}?from=mood`&debug=1;
      log("前往：" + to);
      location.href = to;
    });
  </script>
</body>
</html>
