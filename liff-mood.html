<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ä»Šå¤©çš„å¿ƒæƒ…ï¼Ÿï½œé¸æ“‡èŠå¤©å¤¥ä¼´</title>
  <style>
    :root { --bg:#f7f7f8; --card:#fff; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --primary:#16a34a; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC"; background:var(--bg); color:var(--text); }
    .wrap { max-width: 720px; margin:0 auto; padding:20px; }
    h1 { font-size:22px; margin:8px 0 16px; }
    h2 { font-size:16px; margin:16px 0 8px; color:#111827; }
    p.helper { color:var(--muted); margin:0 0 12px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; }
    .btn { appearance:none; border:1px solid var(--border); background:#fff; padding:10px 12px; border-radius:12px; font-size:20px; cursor:pointer; transition:transform .02s; user-select:none; touch-action:manipulation; }
    .btn:active { transform: scale(0.98); }
    .btn.sel { outline:2px solid var(--primary); border-color: #86efac; background:#ecfdf5; }
    .row { display:flex; gap:10px; }
    .bot { flex:1; display:flex; align-items:center; justify-content:center; padding:12px; font-weight:600; }
    .bot .sub { font-size:12px; color:var(--muted); font-weight:500; }
    .footer { position:sticky; bottom:0; background:linear-gradient(180deg, transparent 0, #fff 20px); padding:16px 0 8px; }
    .primary { width:100%; background:var(--primary); border:none; color:#fff; font-weight:700; height:48px; border-radius:12px; font-size:16px; opacity:.9; }
    .primary:disabled { opacity:.4; }
    header { padding:16px 0 8px; }
    .title { font-size:14px; color:var(--muted); }
    #log { font-size:12px; color:#6b7280; margin-top:8px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Step 1/1</div>
      <h1>ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿç„¶å¾Œæƒ³å’Œèª°èŠèŠ</h1>
    </header>

    <section class="card" aria-labelledby="mood-title">
      <h2 id="mood-title">é¸æ“‡ä»Šå¤©çš„å¿ƒæƒ…ï¼ˆå–®é¸ï¼‰</h2>
      <p class="helper">é»ä¸€ä¸‹é¸æ“‡ä¸€å€‹æœ€æ¥è¿‘ä½ ç¾åœ¨çš„å¿ƒæƒ…ã€‚</p>
      <div class="grid" id="mood-grid">
        <!-- 10 emojis -->
        <button type="button" class="btn" data-value="ğŸ˜€" aria-pressed="false">ğŸ˜€</button>
        <button type="button" class="btn" data-value="ğŸ˜Š" aria-pressed="false">ğŸ˜Š</button>
        <button type="button" class="btn" data-value="ğŸ˜Œ" aria-pressed="false">ğŸ˜Œ</button>
        <button type="button" class="btn" data-value="ğŸ™‚" aria-pressed="false">ğŸ™‚</button>
        <button type="button" class="btn" data-value="ğŸ˜" aria-pressed="false">ğŸ˜</button>
        <button type="button" class="btn" data-value="ğŸ˜•" aria-pressed="false">ğŸ˜•</button>
        <button type="button" class="btn" data-value="ğŸ˜" aria-pressed="false">ğŸ˜</button>
        <button type="button" class="btn" data-value="ğŸ˜¢" aria-pressed="false">ğŸ˜¢</button>
        <button type="button" class="btn" data-value="ğŸ˜ " aria-pressed="false">ğŸ˜ </button>
        <button type="button" class="btn" data-value="ğŸ¤¯" aria-pressed="false">ğŸ¤¯</button>
      </div>
    </section>

    <section class="card" style="margin-top:16px" aria-labelledby="bot-title">
      <h2 id="bot-title">é¸æ“‡èŠå¤©å¤¥ä¼´ï¼ˆå–®é¸ï¼‰</h2>
      <div class="row">
        <button type="button" class="btn bot" id="bot-baobao" data-value="baobao" aria-pressed="false">
          <div>
            <div>å¯¶åŒ…</div>
            <div class="sub">æº«æš–é™ªä¼´</div>
          </div>
        </button>
        <button type="button" class="btn bot" id="bot-penny" data-value="penny" aria-pressed="false">
          <div>
            <div>è£´å¦®</div>
            <div class="sub">ç†æ€§åˆ†æ</div>
          </div>
        </button>
      </div>
    </section>

    <div class="footer">
      <button type="button" class="primary" id="go" disabled>é–‹å§‹èŠå¤©</button>
      <div id="log"></div>
    </div>
  </div>

  <script>
    const CHAT_PAGE = "liff-chat.html"; // ç¬¬äºŒé ï¼ˆåŒè³‡æ–™å¤¾ï¼‰
    const moodGrid = document.getElementById("mood-grid");
    const botButtons = [document.getElementById("bot-baobao"), document.getElementById("bot-penny")];
    const goBtn = document.getElementById("go");
    const $log = document.getElementById("log");

    let mood = null;
    let bot = null;

    function log(...args){ $log.textContent += args.join(" ") + "\\n"; }

    function selectSingleInGrid(grid, value){
      [...grid.querySelectorAll(".btn")].forEach(b => {
        const sel = b.dataset.value === value;
        b.classList.toggle("sel", sel);
        b.setAttribute("aria-pressed", sel ? "true" : "false");
      });
    }
    function selectSingleInRow(buttons, value){
      buttons.forEach(b => {
        const sel = b.dataset.value === value;
        b.classList.toggle("sel", sel);
        b.setAttribute("aria-pressed", sel ? "true" : "false");
      });
    }
    function updateGo(){
      goBtn.disabled = !(mood && bot);
    }

    // Some LINE webviews can swallow 'click', so also listen to 'touchend'
    function onPress(e){
      const t = (e.target.closest && e.target.closest("button.btn")) || null;
      if (!t) return;
      e.preventDefault();
      if (t.parentElement === moodGrid){
        mood = t.dataset.value;
        selectSingleInGrid(moodGrid, mood);
        log("é¸åˆ°å¿ƒæƒ…:", mood);
      } else {
        bot = t.dataset.value;
        selectSingleInRow(botButtons, bot);
        log("é¸åˆ°èŠå¤©å¤¥ä¼´:", bot);
      }
      updateGo();
    }
    moodGrid.addEventListener("click", onPress, {passive:false});
    moodGrid.addEventListener("touchend", onPress, {passive:false});
    botButtons.forEach(b => {
      b.addEventListener("click", onPress, {passive:false});
      b.addEventListener("touchend", onPress, {passive:false});
    });

    goBtn.addEventListener("click", () => {
      try {
        sessionStorage.setItem("mood", mood);
        sessionStorage.setItem("bot", bot);
        localStorage.setItem("mood", mood);
        localStorage.setItem("bot", bot);
      } catch (e) {}
      const to = `${CHAT_PAGE}?from=mood&liff=1`;
      log("å‰å¾€ï¼š", to);
      location.href = to;
    });
  </script>
</body>
</html>
